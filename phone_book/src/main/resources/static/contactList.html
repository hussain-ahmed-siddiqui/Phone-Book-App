<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Contact List</title>
    <link rel="stylesheet" href="/Stylesheets/contact_list.css">
</head>
<body>
<div class="header">
    <input type="text" id="searchBox" placeholder="Search contacts...">
    <button class="button" onclick="searchContacts()">Search</button>
    <button class="button" onclick="createContact()">Create New Contact</button>
    <button class="button" onclick="logout()">Logout</button>
</div>

<table id="contactTable">
    <!-- Table headers and body -->
    <thead>
    <tr>
        <th>Name</th>
        <th>Phone Number</th>
        <th>Email</th>
    </tr>
    </thead>
    <tbody>
    <!-- Contacts will be listed here -->
    </tbody>
</table>

<script>
    // Function to load all contacts
    function loadContacts() {
        fetch('/contacts')
            .then(response => response.json())
            .then(contacts => {
                console.log(contacts);
                const tableBody = document.getElementById('contactTable').getElementsByTagName('tbody')[0];
                tableBody.innerHTML = ''; // Clear existing table body
                contacts.forEach(contact => {
                    const row = tableBody.insertRow();
                    const nameCell = row.insertCell(0);
                    const phoneCell = row.insertCell(1);
                    const emailCell = row.insertCell(2);
                    nameCell.textContent = contact.name;
                    phoneCell.textContent = contact.phoneNum;
                    emailCell.textContent = contact.email; // Assuming 'contact' has an 'email' property
                });
            })
            .catch(error => console.error('Error:', error));
    }

    // Call loadContacts on page load
    window.onload = loadContacts;

    function logout(){
        fetch('/performLogout') .then(response => {
            if (response.ok) {
                window.location.href = '/login'; // Redirect to login page or any other page
            } else {
                throw new Error('Logout failed');
            }
        })
        .catch(error => console.error('Error:', error));

    }

    // Function to search contacts by name
    function searchContacts() {
        const searchQuery = document.getElementById('searchBox').value;
        fetch(`/api/contacts/search?name=${encodeURIComponent(searchQuery)}`)
            .then(response => response.json())
            .then(contacts => {
                const tableBody = document.getElementById('contactTable').getElementsByTagName('tbody')[0];
                tableBody.innerHTML = ''; // Clear existing table body
                contacts.forEach(contact => {
                    const row = tableBody.insertRow();
                    const nameCell = row.insertCell(0);
                    const phoneCell = row.insertCell(1);
                    const emailCell = row.insertCell(2);
                    nameCell.textContent = contact.name;
                    phoneCell.textContent = contact.phoneNum;
                    emailCell.textContent = contact.email; // Assuming 'contact' has an 'email' property
                });
            })
            .catch(error => console.error('Error:', error));
    }
</script>

</body>
</html>
